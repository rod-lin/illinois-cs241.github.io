<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="apple-touch-icon" sizes="180x180" href="images/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="images/favicons/manifest.json">
  <link rel="mask-icon" href="images/favicons/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">

  <title>Networking, Part 5: Shutting down ports, reusing ports and other tricks</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
  <link async rel="stylesheet" href="/css/code-style.css?v=2018-09-08 16:51:38 +0000">
  <link rel="stylesheet" href="/css/main.css?v=2018-09-08 16:51:38 +0000">

</head>

<body>
<!-- Always shows a header, even in smaller screens. -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">

            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>

            <a id="tuxlink"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAJCAMAAAA4jZ0cAAAAM1BMVEX///8CAgQMDAwsLCw0NDSjbQCkbQC+vbzOkwDU1NTlrADqvADxtgD0vQD12wD+/vz+//yBSdYEAAAAAXRSTlMAQObYZgAAADFJREFUCB0FwQkCQDAQBLCsq6g1/v9aCVQBthUwX8BIgStZCpUvKXSSLs6eyd0Pdg5+JwkBVyC74QYAAAAASUVORK5CYII=" title="Tux" alt="Tux" style="margin-left: 1em; width: 24px; filter: drop-shadow(1px 1px 0 white) drop-shadow(1px -1px 0 white) drop-shadow(-1px 1px 0 white) drop-shadow(-1px -1px 0 white); margin-top: 1em;"/></a>

            <a class="navbar-brand navbar-link normal" href="/">CS 241: System Programming</a>
            <a class="navbar-brand navbar-link small" href="/">CS 241</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li>
            <a class="navbar-link" href="/mps.html">MPs</a>
            </li>
            <li>
            <a class="navbar-link" href="/labs.html">Labs</a>
            </li>
            <li>
            <a class="navbar-link" href="/help.html">Help!</a>
            </li>
            <li>
            <a class="navbar-link" href="/schedule.html">Schedule</a>
            </li>
            <li>
            <a class="navbar-link" href="/honors.html">Honors</a>
            </li>
            <li>
            <a class="navbar-link" href="/staff.html">The Crew</a>
            </li>
            <li>
            <a class="navbar-link" href="/search.html">Search</a>
            </li>
            <li>
            <a class="navbar-link" href="/wikibook/home.html">Wikibook</a>
            </li>
          </ul>
        </div>
        </div>
</nav>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-2 col-sm-1 col-xs-0"></div>
    <div class="col-md-8 col-sm-10 col-xs-12">
      <div class="wrapper">
        <div class="pad"><div class="card">
          <div class="title">
            <div class="speaker-wrapper">
              <button onclick="speak()" class="speaker" alt="Read Page"></button>
            </div>
            <h1>
              Networking, Part 5: Shutting down ports, reusing ports and other tricks
              
                <a class="github-link hidden-xs" href="https://github.com/angrave/SystemProgramming/wiki//Networking,-Part-5:-Shutting-down-ports,-reusing-ports-and-other-tricks">Edit on Github</a>
              
            </h1>
          </div>
          <div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
            
          </div></div></div>
        </div></div>
      </div>
      <div class="toc-wrapper">
<h4>Content</h4>
<ul class="toc">
<li><a id="toc_what-is-the-difference-shutdown-and-close" href="#what-is-the-difference-shutdown-and-close" class="fancy-link">What is the difference shutdown and close?</a></li>
<li><a id="toc_when-i-re-run-my-server-code-it-doesnt-work-why" href="#when-i-re-run-my-server-code-it-doesnt-work-why" class="fancy-link">When I re-run my server code it doesn’t work! Why?</a></li>
<li><a id="toc_can-a-tcp-client-bind-to-a-particular-port" href="#can-a-tcp-client-bind-to-a-particular-port" class="fancy-link">Can a TCP client bind to a particular port?</a></li>
<li><a id="toc_i-built-a-simple-tcp-client-or-server-but-my-process-sometimes-just-quits-why" href="#i-built-a-simple-tcp-client-or-server-but-my-process-sometimes-just-quits-why" class="fancy-link">I built a simple TCP client or server but my process sometimes just quits! Why?</a></li>
<li><a id="toc_who-connected-to-my-server" href="#who-connected-to-my-server" class="fancy-link">Who connected to my server?</a></li>
<li><a id="toc_getnameinfo-example-whats-my-ip-address" href="#getnameinfo-example-whats-my-ip-address" class="fancy-link">getnameinfo Example: What’s my IP address?</a></li>
<li><a id="toc_whats-my-machines-ip-address-shell-version" href="#whats-my-machines-ip-address-shell-version" class="fancy-link">What’s my machine’s IP address (shell version)</a></li>
</ul>
</div>
      <div id="content">
        
        <div class="wrapper">

</div>
        <div class="wrapper">
<div class="pad"><div class="card">
<div class="title"><h2 id="what-is-the-difference-shutdown-and-close" class="title-text">What is the difference shutdown and close?<a class="anchor title-text" href="#what-is-the-difference-shutdown-and-close">#</a>
</h2></div>









<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>Use the <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/shutdown" class="fancy-link">shutdown</a></code> call when you no longer need to read any more data from the socket, write more data, or have finished doing both.
When you shutdown a socket for further writing (or reading) that information is also sent to the other end of the connection. For example if you shutdown the socket for further writing at the server end, then a moment later, a blocked <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/read" class="fancy-link">read</a></code> call could return 0 to indicate that no more bytes are expected.</p>
<p>Use <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/close" class="fancy-link">close</a></code> when your process no longer needs the socket file descriptor.</p>
<p>If you <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/fork" class="fancy-link">fork</a></code>-ed after creating a socket file descriptor, all processes need to close the socket before the socket resources can be re-used.  If you shutdown a socket for further read then all process are be affected because you’ve changed the socket, not just the file descriptor.</p>
<p>Well written code will <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/shutdown" class="fancy-link">shutdown</a></code> a socket before calling <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/close" class="fancy-link">close</a></code> it.</p>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="when-i-re-run-my-server-code-it-doesnt-work-why" class="title-text">When I re-run my server code it doesn’t work! Why?<a class="anchor title-text" href="#when-i-re-run-my-server-code-it-doesnt-work-why">#</a>
</h2></div>







<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>By default, after a socket is closed the port enters a time-out state during which time it cannot be re-used (‘bound to a new socket’).</p>
<p>This behavior can be disabled by setting the socket option REUSEPORT before bind-ing to a port:</p>
<pre><code class="language-C"><a class="code-copy" rel="code-copy-0" onclick="onCopy(this);">Copy</a>    <span class="kt">int</span> <span class="n">optval</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">setsockopt</span><span class="p">(</span><span class="n">sock_fd</span><span class="p">,</span> <span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">SO_REUSEPORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">optval</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">optval</span><span class="p">));</span>

    <span class="n">bind</span><span class="p">(</span><span class="n">sock_fd</span><span class="p">,</span> <span class="p">...);</span>
<textarea id="code-copy-0" class="code-copy-textarea" value="    int optval = 1;
    setsockopt(sock_fd, SOL_SOCKET, SO_REUSEPORT, &amp;amp;optval, sizeof(optval));

    bind(sock_fd, ...);
"></textarea></code></pre>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="can-a-tcp-client-bind-to-a-particular-port" class="title-text">Can a TCP client bind to a particular port?<a class="anchor title-text" href="#can-a-tcp-client-bind-to-a-particular-port">#</a>
</h2></div>





<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>Yes! In fact outgoing TCP connections are automatically bound to an unused port on the client. Usually it’s unnecessary to explicitly set the port on the client because the system will intelligently find an unusued port on a reasonable interface (e.g. the wireless card, if currently connected by WiFi connection). However it can be useful if you needed to specifically choose a particular ethernet card, or if a firewall only allows outgoing connections from a particular range of port values.</p>
<p>To explicitly bind to an ethernet interface and port, call <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/bind" class="fancy-link">bind</a></code> before <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/connect" class="fancy-link">connect</a></code></p>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="i-built-a-simple-tcp-client-or-server-but-my-process-sometimes-just-quits-why" class="title-text">I built a simple TCP client or server but my process sometimes just quits! Why?<a class="anchor title-text" href="#i-built-a-simple-tcp-client-or-server-but-my-process-sometimes-just-quits-why">#</a>
</h2></div>







<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>If your process writes to a socket that has already been shutdown by the other end of the TCP connection, then your process will be sent a SIGPIPE signal. From our previous discussion on pipes, you might remember the default action is to shutdown the process. A workaround to this is to ignore SIGPIPE signals or to implement your own signal handler.</p>
<pre><code class="language-C"><a class="code-copy" rel="code-copy-1" onclick="onCopy(this);">Copy</a><span class="kt">void</span> <span class="nf">handle_sigpipe</span><span class="p">(</span><span class="kt">int</span> <span class="n">signal</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">mesg</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
  <span class="n">sprintf</span><span class="p">(</span><span class="n">mesg</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">****** SIGPIPE  - no one is listening :-( ******</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">mesg</span><span class="p">));</span>
<span class="p">}</span>
<textarea id="code-copy-1" class="code-copy-textarea" value='void handle_sigpipe(int signal) {
  char mesg[1000];
  sprintf(mesg, "\n****** SIGPIPE  - no one is listening :-( ******\n");
  write(1, mesg, strlen(mesg));
}
'></textarea></code></pre>
<p>And register the signal handler using <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/signal" class="fancy-link">signal</a></code> (or the newer <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/sigaction" class="fancy-link">sigaction</a></code> or <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/pthread_sigmask" class="fancy-link">pthread_sigmask</a></code>)…</p>
<pre><code class="language-C"><a class="code-copy" rel="code-copy-2" onclick="onCopy(this);">Copy</a><span class="n">signal</span><span class="p">(</span><span class="n">SIGPIPE</span><span class="p">,</span><span class="n">handle_sigpipe</span><span class="p">)</span>
<textarea id="code-copy-2" class="code-copy-textarea" value="signal(SIGPIPE,handle_sigpipe)
"></textarea></code></pre>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="who-connected-to-my-server" class="title-text">Who connected to my server?<a class="anchor title-text" href="#who-connected-to-my-server">#</a>
</h2></div>










<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>The <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/accept" class="fancy-link">accept</a></code> system call can optionally provide information about the remote client, by passing in a sockaddr struct. Different protocols have differently variants of the  <code class="highlighter-rouge">struct sockaddr</code>, which are different sizes. The simplest struct to use is the <code class="highlighter-rouge">sockaddr_storage</code> which is sufficiently large to represent all possible types of sockaddr. Notice that C does not have any model of inheritance. Therefore we need to explicitly cast our struct to the ‘base type’ struct sockaddr.</p>
<pre><code class="language-C"><a class="code-copy" rel="code-copy-3" onclick="onCopy(this);">Copy</a>    <span class="k">struct</span> <span class="n">sockaddr_storage</span> <span class="n">clientaddr</span><span class="p">;</span>
    <span class="n">socklen_t</span> <span class="n">clientaddrsize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">clientaddr</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">client_id</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">passive_socket</span><span class="p">,</span>
            <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">clientaddr</span><span class="p">,</span>
             <span class="o">&amp;</span><span class="n">clientaddrsize</span><span class="p">);</span>
<textarea id="code-copy-3" class="code-copy-textarea" value="    struct sockaddr_storage clientaddr;
    socklen_t clientaddrsize = sizeof(clientaddr);
    int client_id = accept(passive_socket,
            (struct sockaddr *) &amp;amp;clientaddr,
             &amp;amp;clientaddrsize);
"></textarea></code></pre>
<p>We’ve already seen <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/getaddrinfo" class="fancy-link">getaddrinfo</a></code> that can build a linked list of addrinfo entries (and each one of these can include socket configuration data). What if we wanted to turn socket data into IP and port addresses? Enter <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/getnameinfo" class="fancy-link">getnameinfo</a></code> that can be used to convert a local or remote socket information into a domain name or numeric IP. Similarly the port number can be represented as a service name (e.g. “http” for port 80). In the example below we request numeric versions for the client IP address and client port number.</p>
<pre><code class="language-C"><a class="code-copy" rel="code-copy-4" onclick="onCopy(this);">Copy</a>    <span class="n">socklen_t</span> <span class="n">clientaddrsize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">clientaddr</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">client_id</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">sock_id</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">clientaddr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clientaddrsize</span><span class="p">);</span>
    <span class="kt">char</span> <span class="n">host</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="n">port</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
    <span class="n">getnameinfo</span><span class="p">((</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">clientaddr</span><span class="p">,</span>
          <span class="n">clientaddrsize</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">host</span><span class="p">),</span> <span class="n">port</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">port</span><span class="p">),</span>
          <span class="n">NI_NUMERICHOST</span> <span class="o">|</span> <span class="n">NI_NUMERICSERV</span><span class="p">);</span>
<textarea id="code-copy-4" class="code-copy-textarea" value="    socklen_t clientaddrsize = sizeof(clientaddr);
    int client_id = accept(sock_id, (struct sockaddr *) &amp;amp;clientaddr, &amp;amp;clientaddrsize);
    char host[256], port[256];
    getnameinfo((struct sockaddr *) &amp;amp;clientaddr,
          clientaddrsize, host, sizeof(host), port, sizeof(port),
          NI_NUMERICHOST | NI_NUMERICSERV);
"></textarea></code></pre>
<p>Todo: Discuss NI_MAXHOST and NI_MAXSERV, and NI_NUMERICHOST</p>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="getnameinfo-example-whats-my-ip-address" class="title-text">getnameinfo Example: What’s my IP address?<a class="anchor title-text" href="#getnameinfo-example-whats-my-ip-address">#</a>
</h2></div>





<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>To obtain a linked list of IP addresses of the current machine use <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/getifaddrs" class="fancy-link">getifaddrs</a></code> which will return a linked list of IPv4 and IPv6 IP addresses (and potentially other interfaces too). We can examine each entry and use <code class="highlighter-rouge"><a href="https://linux.die.net/man/3/getnameinfo" class="fancy-link">getnameinfo</a></code> to print the host’s IP address.
The  ifaddrs struct includes the family but does not include the sizeof the struct. Therefore we need to manually determine the struct sized based on the family (IPv4 v IPv6)</p>
<pre><code class="language-C"><a class="code-copy" rel="code-copy-5" onclick="onCopy(this);">Copy</a> <span class="p">(</span><span class="n">family</span> <span class="o">==</span> <span class="n">AF_INET</span><span class="p">)</span> <span class="o">?</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">)</span> <span class="o">:</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in6</span><span class="p">)</span>
<textarea id="code-copy-5" class="code-copy-textarea" value=" (family == AF_INET) ? sizeof(struct sockaddr_in) : sizeof(struct sockaddr_in6)
"></textarea></code></pre>
<p>The complete code is shown below.</p>
<pre><code class="language-C"><a class="code-copy" rel="code-copy-6" onclick="onCopy(this);">Copy</a>    <span class="kt">int</span> <span class="n">required_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span> <span class="c1">// Change to AF_INET6 for IPv6</span>
    <span class="k">struct</span> <span class="n">ifaddrs</span> <span class="o">*</span><span class="n">myaddrs</span><span class="p">,</span> <span class="o">*</span><span class="n">ifa</span><span class="p">;</span>
    <span class="n">getifaddrs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">myaddrs</span><span class="p">);</span>
    <span class="kt">char</span> <span class="n">host</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="n">port</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ifa</span> <span class="o">=</span> <span class="n">myaddrs</span><span class="p">;</span> <span class="n">ifa</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">ifa</span> <span class="o">=</span> <span class="n">ifa</span><span class="o">-&gt;</span><span class="n">ifa_next</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">family</span> <span class="o">=</span> <span class="n">ifa</span><span class="o">-&gt;</span><span class="n">ifa_addr</span><span class="o">-&gt;</span><span class="n">sa_family</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">family</span> <span class="o">==</span> <span class="n">required_family</span> <span class="o">&amp;&amp;</span> <span class="n">ifa</span><span class="o">-&gt;</span><span class="n">ifa_addr</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">getnameinfo</span><span class="p">(</span><span class="n">ifa</span><span class="o">-&gt;</span><span class="n">ifa_addr</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">family</span> <span class="o">==</span> <span class="n">AF_INET</span><span class="p">)</span> <span class="o">?</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">)</span> <span class="o">:</span>
                                <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in6</span><span class="p">),</span>
                                <span class="n">host</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">host</span><span class="p">),</span> <span class="n">port</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
                                 <span class="p">,</span> <span class="n">NI_NUMERICHOST</span> <span class="o">|</span> <span class="n">NI_NUMERICSERV</span>  <span class="p">))</span>
                <span class="n">puts</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
<textarea id="code-copy-6" class="code-copy-textarea" value="    int required_family = AF_INET; // Change to AF_INET6 for IPv6
    struct ifaddrs *myaddrs, *ifa;
    getifaddrs(&amp;amp;myaddrs);
    char host[256], port[256];
    for (ifa = myaddrs; ifa != NULL; ifa = ifa-&amp;gt;ifa_next) {
        int family = ifa-&amp;gt;ifa_addr-&amp;gt;sa_family;
        if (family == required_family &amp;amp;&amp;amp; ifa-&amp;gt;ifa_addr) {
            if (0 == getnameinfo(ifa-&amp;gt;ifa_addr,
                                (family == AF_INET) ? sizeof(struct sockaddr_in) :
                                sizeof(struct sockaddr_in6),
                                host, sizeof(host), port, sizeof(port)
                                 , NI_NUMERICHOST | NI_NUMERICSERV  ))
                puts(host);
            }
        }
"></textarea></code></pre>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="whats-my-machines-ip-address-shell-version" class="title-text">What’s my machine’s IP address (shell version)<a class="anchor title-text" href="#whats-my-machines-ip-address-shell-version">#</a>
</h2></div>



<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>Answer: use <code class="highlighter-rouge">ifconfig</code> (or Windows’s ipconfig)
However this command generates a lot of output for each interface, so we can filter the output using grep</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifconfig | grep inet

Example output:
	inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 
	inet 127.0.0.1 netmask 0xff000000 
	inet6 ::1 prefixlen 128 
	inet6 fe80::7256:81ff:fe9a:9141%en1 prefixlen 64 scopeid 0x5 
	inet 192.168.1.100 netmask 0xffffff00 broadcast 192.168.1.255
</code></pre></div></div>
</div></div></div>
</div></div>
</div>
        
        <div class="wrapper">
</div>
      </div>
      <div class="col-md-2 col-sm-1 col-xs-0"></div>
    </div>
  </div>
  <script>
    var github_repo = "illinois-cs241/illinois-cs241.github.io";
    var github_path = "_wikibook/networking-part-5-shutting-down-ports-reusing-ports-and-other-tricks.md";
  </script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" crossorigin="anonymous"></script>
<script src="/js/main.js?v=2018-09-08 16:51:38 +0000"></script>

<script>
$(document).ready(function() { 
    $("#tuxlink").prop("href", "javascript:;").click(function() { 
        if ("WebkitAppearance" in document.documentElement.style) { 
            var style = document.createElement("style"); 
            style.setAttribute("id", "tuxstyle"); 
            style.appendChild(document.createTextNode("")); 
            document.head.appendChild(style); 
            var sheet = style.sheet;
            sheet.insertRule("::-webkit-scrollbar-thumb {border-radius: 0; background-color: white; -webkit-box-shadow: none;}", 0); 
        } 

        const hackerKey = 'hackerLocalKey';
        const hackerOff = "off";
        const hackerOn = "on";

        if (window.localStorage.getItem(hackerKey) === null) {
            window.localStorage.setItem(hackerKey, hackerOff);
        }

        $("#tuxlink").unbind('click').click(function() { 
            const hackerClass = 'hacker';
            $('html, body, header, nav, table, pre, span, :not(.card-staff) > a, p, h1, h2, h3, h4, h5, h6').toggleClass(hackerClass);
            $('ul, img, pre').toggleClass(hackerClass);
            $('.toc').toggleClass(hackerClass);
            $('.content .highlighter-rouge').toggleClass(hackerClass);
            $('.large-centered.columns').toggleClass(hackerClass);
            $('.pad').toggleClass(hackerClass);
            $('a').toggleClass(hackerClass);
            $('tbody tr:nth-child(2n+1)').toggleClass(hackerClass);
            $("#tuxlink img").toggleClass(hackerClass);

            const val = window.localStorage.getItem(hackerKey);
            if (val === hackerOff) {
                window.localStorage.setItem(hackerKey, hackerOn);
            } else {
                window.localStorage.setItem(hackerKey, hackerOff);
            }
            return false; 
        }); 
        $("#tuxlink").click();
        const stored = window.localStorage.getItem(hackerKey);
        if (stored === hackerOn) {
            console.log("Hello!")
            $("#tuxlink").click();
        } else {
            console.log("Noo");
        }

        return false; 
    }); 
    } 
    ); 
    </script>

<script src="/js/analytics.js"></script>

<footer class="">

<div class="container-fluid">
<div class="shadow"></div>

</div>

</footer>

</body>
</html>
